# ClamAV Daemon Configuration for Railway (memory-constrained environment)
# This file configures clamd to use minimal memory while still being effective

# Socket configuration
LocalSocket /run/clamav/clamd.sock
LocalSocketGroup clamav
LocalSocketMode 666

# Timeout for connections
CommandReadTimeout 120

# Logging
LogFile /tmp/clamd.log
LogTime yes
LogFileMaxSize 10M
LogVerbose no
LogSyslog no

# Memory and performance tuning for Railway's 512MB-1GB containers
MaxThreads 2
MaxConnectionQueueLength 10
MaxQueue 50

# Limit memory usage - CRITICAL for Railway
# Only scan files up to 10MB (our upload limit)
MaxFileSize 10M
MaxScanSize 10M

# Disable archive scanning to save memory
ScanArchive no
ScanPE no
ScanELF no
ScanOLE2 no
ScanPDF no
ScanSWF no
ScanXMLDOCS no
ScanHWP3 no

# Disable mail scanning (we don't scan emails)
ScanMail no
ScanPartialMessages no

# Heuristic scanning - disable to save memory
HeuristicScanPrecedence no
StructuredDataDetection no

# Enable algorithmic detection (lighter than heuristics)
AlgorithmicDetection yes

# Performance - use memory efficiently
IdleTimeout 30
ExcludePath ^/proc/
ExcludePath ^/sys/

# Only detect true malware, not PUAs
DetectPUA no
ExcludePUA .MSIL
ExcludePUA .Win
ExcludePUA .Osx
ExcludePUA .Android

# Misc
FixStaleSocket yes
TCPSocket 3310
TCPAddr 127.0.0.1
